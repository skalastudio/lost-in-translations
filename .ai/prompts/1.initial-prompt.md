You are a senior macOS engineer. Build a native macOS 14+ menu bar app in Swift/SwiftUI called “Lost in Translations”.
App Store requirements: use only Apple frameworks; no external servers required; no tracking; keys stored securely.

# GOAL
A menu bar writing companion that can:
1) translate text into 2–3 target languages at once,
2) improve/rewrite sentences,
3) provide synonym suggestions,
using user-provided credentials for multiple LLM providers (OpenAI, Anthropic Claude, Google Gemini).

# IMPORTANT AUTH CONSTRAINT
Do NOT implement “login with chat account” using the user subscriptions, like it is used on Mac Settings on Apple Inteligent Assistant setup:
Implement on setup of chat account, a specific window for the consent flow

# UI/UX
- Menu bar item opens a popover window with:
  - Input TextEditor (supports paste)
  - Controls row:
    - Mode segmented control: Translate / Improve / Synonyms
    - Intent picker: Email / SMS / Chat / Plain Text
    - Tone picker: Neutral / Formal / Informal / Professional / Friendly / Direct
    - Provider picker: Auto / OpenAI / Claude / Gemini
    - Model picker:
      - Default: Fast / Balanced / Best
      - Advanced disclosure: show exact model list per provider
    - Languages: choose 2 or 3 target languages (min 2 max 3). Provide PT/EN/DE presets.
  - Action buttons: Run, Copy All, Clear
  - Results area:
    - Show outputs grouped by language
    - Each result has: Copy button + “Use this” button
    - If Provider=Auto, also show a “Compare” view (grid) that runs same request on selected providers/models and lets user choose winner

# DATA + STATE
- Persist non-sensitive preferences using AppStorage:
  - default mode, intent, tone, provider selection, model tier, languages
- Persist optional history locally (SwiftData) if enabled:
  - timestamp, input text hash, mode, intent, tone, languages, provider/model used, outputs
  - Provide toggle “Keep History” + “Clear History” button
- Store API keys in Keychain only

# NETWORKING
Implement provider clients with URLSession:
- OpenAI: chat/completions or responses API (choose one and be consistent)
- Anthropic: messages endpoint
- Gemini: generateContent endpoint (API key auth)
Add robust error handling:
- Missing key -> show friendly inline message + open settings
- Rate limit / network -> retry option
- Provider errors -> show provider-specific error description

# PROMPTING
C dreate a single internal “Task Spec” builder that turns UI choices into a structured instruction:
- Translate: produce 2–3 translations with natural phrasing, respecting intent + tone, keep meaning, avoid hallucinations, preserve names/numbers.
- Improve: rewrite in same language as input unless user chooses targets; respect intent + tone; keep meaning.
- Synonyms: return list of synonyms + short usage notes; avoid rare/uncommon words unless asked; preserve register (formal/informal).
Return results in strict JSON so parsing is deterministic.

# TECHNICAL
- Use Swift concurrency (async/await)
- Use MVVM:
  - ViewModel orchestrates requests and state
  - Provider clients are separate types
  - JSON parsing with Codable
- Apple foundation models APIs to interact with models  - 
- Add a small “Diagnostics” panel:
  - shows last request provider/model, token estimation (approx), latency, last error

# DELIVERABLES
Produce:
1) project file structure,
2) key Swift files (App entry, menu bar popover UI, Settings window, ViewModel, Keychain helper, provider clients, models),
3) realistic placeholder model lists (and an easy way to update them),
4) comments explaining key parts.
